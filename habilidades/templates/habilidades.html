	{% extends "template.html" %}
{% load staticfiles %}
{% block head %}
	<title>Habilidades | OportunidApp </title>
{% endblock %}
{% block content %}
<div class="row">
	<div class="full col-sm-12">
		<a href="#" class="btn btn-primary pull" id="hbl">Nueva</a>
		<a class="btn btn-success pull" id="btn-habilidades-activas">Activas</a>
		<a class="btn btn-danger pull" id="btn-habilidades-noActivas">Desactivadas</a>
	</div>
</div>
<div class="row">
	<div class="col-sm-12">
		<div class="well" style="display:none"> 
			<form id="nueva-habilidad-form" method="post" enctype='multipart/form-data'>
				<h4>Nueva Habilidad</h4>
				<div class="form-group">
					{{ form.as_p }}
				</div>
				<div class="text-right">
					<a href="" class="btn btn-danger" id="cancel">Cancelar</a>
					<input type="submit" value="Agregar + " class="btn btn-primary">
				</div>
				<ul class="list-inline">
				</ul>
			</form>
		</div>
</div>
</div>
{%verbatim%}
<ul id="listul">
</ul>
<p id="foo"></p>
<div class="row">
	<div id="results"></div>
</div>
<script id="habilidadesTempl" type="text/x-handlebars-template">
{{#if this}}
	{{#each this }}
	<div class="col-md-12">
		<div class="label-category label-description text-center">
			<strong class="desc3">{{ fields.categoria }}</strong>
		</div>
	</div>

	<div class="habilidad-item">
		<div className="col-sm-12">
			<div class="row panel panel-default">	
				<div class="col-sm-12 col-md-4 col-lg-3 div-align">
					<img src="/media/{{ fields.foto }}" class="desc-img" alt="{{ fields.nhabilidad }}">
				</div>
				<div class="col-sm-12 col-md-5 col-lg-6 div-align">
					<h3>
						<a href="/habilidades/{{ pk }}">
							{{ fields.nhabilidad }}
						</a>
					</h3>

					<p>{{ fields.descripcion }}</p>

				</div>
				<div class="col-sm-12 col-md-3 col-lg-3">
					<div class="text-top text-center col-xs-6 col-sm-4 col-md-12 col-lg-12">
						<div class="label-descp label-warning">
							<i class="glyphicon glyphicon-star desc3"></i>
							{{#if fields.val_promedio}}
								<span class="desc">Puntuacion: </span>
								<strong class="desc3">{{ fields.val_promedio }}</strong>
							{{else}}
								<strong class="desc3">ninguno</strong>
							{{/if}}
						</div>
					</div>
					<div class="text-top text-center col-xs-6 col-sm-4 col-md-12 col-lg-12">
						<div class="label-descp label-success">
							<i class="glyphicon glyphicon-th-list desc3"></i> 
							{{#if fields.num_solicitudes}}
								<span class="desc">Solicitudes: </span>
								<strong class="desc3">{{ fields.num_solicitudes }}</strong>
							{{else}}
								<strong class="desc3">ninguno</strong>
							{{/if}}
						</div>
					</div>
					<div class="text-top text-center col-xs-6 col-sm-4 col-md-12 col-lg-12">
						<div class="label-descp label-danger">
							{{#if fields.precio}}
							<i class="glyphicon glyphicon-usd desc3"></i> 
							<span class="desc">Precio: </span></a><strong class="desc3">{{ fields.precio }}</strong>
							{{else}}
								<span><b>ninguno</b></span>
							{{/if}}
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	{{/each}}
{{else}}
	<p>No tienes ninguna habilidad.</p>
{{/if}}
</script>
{%endverbatim%}
{% endblock %}
{% block scripts %}
	<script src="{% static 'jsapp/csrf_load.js' %}"></script>
	<script>
		$(function() {
			listarHabilidadesActivas();
			var spinner;

			function listarHabilidadesActivas () {
				$.ajax({
					url: '{% url 'habilidadesActivas' %}',
					type: "GET",
					beforeSend: function(){
						var target = document.getElementById('foo');
						spinner = new Spinner().spin(target);
					},
					success: function(json){
						console.log(json);
						var source   = $("#habilidadesTempl").html();
						var template = Handlebars.compile(source);
						t = template(json);
						setTimeout(function(){
							spinner.stop();
							$("#results").html(t);
						},1000);
					},
				});
			};

			function listarHabilidadesNoActivas(){
				$.ajax({
					url : '{% url 'habilidadesNoActivas' %}',
					type : "GET",
					beforeSend : function(){
						var target = document.getElementById('foo');
						spinner = new Spinner().spin(target);
					},
					success: function(json){
						var source   = $("#habilidadesTempl").html();
						var template = Handlebars.compile(source);
						t = template(json);
						setTimeout(function(){
							spinner.stop();
							$("#results").html(t);
						},1000);
					},
				});
			};

			$('#nueva-habilidad-form').on('submit', function(event){
				event.preventDefault();
				$.ajax({
					url: '{% url 'nuevaHabilidad' %}',
					type: "POST",
					dataType: 'json',
					data: {
						categoria: $('#id_categoria').val(),
						nhabilidad: $('#id_nhabilidad').val(),
						descripcion: $('#id_descripcion').val(),
						precio: $('#id_precio').val(),
					},
					success: function(json){
						$("#nueva-habilidad-form").trigger('reset');
						$('.well').hide(100);
						$('#hbl').show(200);
						listarHabilidadesActivas();
						//console.log(json);
					},
				});
			});

			$('.well').hide();
			$('#hbl').click(function(event){
				$('.well').show();	
				$('#hbl').hide();
				event.preventDefault();
			});
			$('#cancel').click(function(event){
				$("#nueva-habilidad-form").trigger('reset');
				$('.well').hide();
				$('#hbl').show();
				event.preventDefault();
			});

			$('#btn-habilidades-activas').click(function(){
				$('#btn-habilidades-noActivas').removeClass("active").addClass("");
				$('#btn-habilidades-activas').addClass("active");
				listarHabilidadesActivas();
			});

			$('#btn-habilidades-noActivas').click(function(){
				$('#btn-habilidades-activas').removeClass("active");
				$('#btn-habilidades-noActivas').addClass("active");
				listarHabilidadesNoActivas();
			});

		});
	</script>
{% endblock %}